---
title: "SQL & R: ‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏îüê§" 
output:
  html_document: default
  pdf_document: default
---

<style>
  .section h2, .section h3 {
    display: flex;
    align-items: center;
  }
  .section h2 img, .section h3 img {
    margin-right: 10px;
  }
</style>

# üî• ‡∏õ‡∏•‡∏∏‡∏Å‡∏û‡∏•‡∏±‡∏á SQL ‡∏à‡∏≤‡∏Å DataRockie BootCamp12 Sprint SQL üê§üíõ

## ![](ptoy.png){width="2200"}

‡∏´‡∏ß‡∏±‡∏î‡∏î‡∏µ‡∏Ñ‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ü‡∏•‡∏∏‡∏Ñ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏£‡∏á‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•‡πÉ‡∏à‡∏à‡∏≤‡∏Å `BootCamp`**‡∏ô‡∏≠‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡πÅ‡∏ï‡πà‡∏ô‡∏≠‡∏ô‡∏ô‡∏∞!** ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ô‡∏£‡πâ‡∏≠‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏≠‡∏ô‡πÄ‡∏•‡∏ó ‡∏°‡∏µ‡πÅ‡∏ï‡πà‡∏™‡∏≠‡∏ô‡πÅ‡∏ñ‡∏° 555+ ‡∏™‡∏≠‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå ‡∏ô‡∏±‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πåü§£

‡πÇ‡∏î‡∏¢ **Stack** ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ ‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡∏û‡∏•‡∏±‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á **`R`** ‡∏Å‡∏±‡∏ö **`SQL`** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ ‡∏ñ‡πâ‡∏≤‡∏û‡∏µ‡πà ‡πÜ ‡∏ô‡πâ‡∏≠‡∏á ‡πÜ ‡∏Ñ‡∏ô‡πÑ‡∏´‡∏ô‡∏≠‡∏¢‡∏≤‡∏Å‡∏°‡∏µ **`Portfolio`** ‡πÄ‡∏à‡πã‡∏á ‡πÜ ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ ‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏°‡∏Ñ‡πå‡∏ü‡∏•‡∏∏‡∏Ñ‡πÑ‡∏î‡πâ 555+

‡πÉ‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏ü‡∏•‡∏∏‡∏Ñ‡∏à‡∏∞‡πÉ‡∏ä‡πâ **`Data`** ‡∏à‡∏≤‡∏Å **`Chinook Database`** ‡∏ã‡∏∂‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á **`SQL`** ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å ‡πÜ ‡∏ó‡∏µ‡πà‡∏ô‡∏≠‡∏¢‡∏°‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ô‡∏°‡∏µ 2 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏≠:

1.  **`Retrieve & Filter`**: **`‡∏î‡∏∂‡∏á`** ‡πÅ‡∏•‡∏∞ **`‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•`** (Rows) ‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
2.  **`Summarize & Grouping`**: **‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•** ‡πÅ‡∏•‡∏∞ **‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•** (**`Aggregation`**) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏° ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏ö‡∏∑‡∏≠‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏ö

### SQL Clause ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á `Data`

‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏•‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡πÄ‡∏Ñ‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏Å‡∏±‡∏ô555+ ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡∏≠‡∏á `Database Engine` ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ôüíõ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏¥‡∏ß‡∏£‡∏µ ‡∏ó‡∏µ‡πà `Data Analyst` ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ:

1.  **`FROM`** & **`JOIN`**: ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å `Table`‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏° `Data` ‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏´‡∏•‡πà‡∏á‡∏°‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß.
2.  **`WHERE`**: ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£ **`Filter` ‡πÅ‡∏ñ‡∏ß** (Rows) ‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç (‡∏Å‡πà‡∏≠‡∏ô Grouping).
3.  **`GROUP BY`** & **`AGGREGATE FUNCTION()`**: ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£ **`Grouping`** ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÄ‡∏ä‡πà‡∏ô `COUNT()`, `SUM()`, `AVG()` ‡∏û‡∏π‡∏î‡∏á‡πà‡∏≤‡∏¢‡πÜ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡πâ‡∏≠‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÜ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ñ‡πà‡∏≤‡πÜ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß.
4.  **`HAVING`**: ‡∏Å‡∏≤‡∏£ **`Grouping`** ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô `WHERE` ‡πÅ‡∏Ñ‡πà `HAVING` ‡∏ó‡∏≥‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á.
5.  **`SELECT`**: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å `Columns`.
6.  **`ORDER BY`**: ‡∏Å‡∏≤‡∏£ **`SORTING`** .
7.  **`CASE WHEN`**: ‡∏Ñ‡∏∑‡∏≠ `Control Flow (If-Then-Else)` ‡∏Ç‡∏≠‡∏á `SQL` ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡πà‡∏≤‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏´‡∏°‡πà.
8.  **`Common Table Expressions (CTEs)`**: ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡πÄ‡∏Ñ‡πâ‡∏≤‡∏ö‡∏≠‡∏Å‡∏Å‡∏±‡∏ô555+ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏¥‡∏ß‡∏£‡∏µ‡∏ó‡∏µ‡πà `complex` ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢.

‡πÇ‡∏î‡∏¢ Sheet ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á **`R`** + **`SQL`** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô (Portfolio) ‡∏ó‡∏µ‡πà‡∏ó‡∏£‡∏á‡∏û‡∏•‡∏±‡∏á‡∏ñ‡∏∂‡∏á‡πÅ‡∏°‡πâ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ä‡∏≤‡∏ß `Bootcamp12` ‡∏à‡∏∞‡∏¢‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á `Sprint R` ‡∏ü‡∏•‡∏∏‡∏Ñ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤`Generalist's SQL` 555+‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ß‡πà‡∏≤ `Skills in combination are more powerful than individual skills` ‡πÄ‡∏â‡∏µ‡∏¢‡∏ö

-   **‡πÇ‡∏Ñ‡πâ‡∏î SQL ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á** (Executable Code): ‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏°‡∏Ñ‡πå‡∏°‡∏≤‡∏Ç‡∏≠ 555+
-   **‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏ö‡∏ö`Interactive`‡πÅ‡∏•‡∏∞ `Dynamic`** : ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ **‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤** ‡πÅ‡∏•‡∏∞ **‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á** ‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à `DT` ‡πÄ‡∏î‡πá‡∏î‡∏î‡∏î‡∏î‡∏î‡∏î‡∏î

**‡∏•‡∏∏‡∏¢‡∏Å‡∏±‡∏ô ‡πÄ‡∏¢‡πâ!**

------------------------------------------------------------------------

## ![](DuckCool.png){width="22"} 1. Environment Setup

‡πÇ‡∏î‡∏¢‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ü‡∏•‡∏∏‡∏Ñ‡∏û‡∏≤‡πÑ‡∏õ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• `Chinnook` ‡∏Å‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏•‡∏¢‡πÄ‡∏¢‡πâ

-   ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ **R** ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô (`DBI`, `RSQLite`, `DT`).
-   **‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î** ‡πÅ‡∏•‡∏∞ **‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠** ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á **Chinook** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ R ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `SQL` ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô R ‡πÑ‡∏î‡πâ

```{r setup, message=FALSE, warning=FALSE}
# Install packages if they are not already installed
if (!require(DBI)) install.packages("DBI")
if (!require(RSQLite)) install.packages("RSQLite")
if (!require(DT)) install.packages("DT") # For interactive tables

# Load libraries
library(DBI)
library(RSQLite)
library(DT)

# Download the Chinook database if it doesn't exist
db_file <- "chinook.db"
if (!file.exists(db_file)) {
  download.file("https://www.sqlitetutorial.net/wp-content/uploads/2018/03/chinook.zip", "chinook.zip", mode = "wb")
  unzip("chinook.zip")
}

# Establish a connection to the database
con <- dbConnect(RSQLite::SQLite(), db_file)
```

## ![](DuckCool.png){width="22"} 2. JOIN Clause

‡∏°‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `JOIN` ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°‡πÅ‡∏ñ‡∏ß‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô ‡πÇ‡∏î‡∏¢‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ô. ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Ñ‡∏¥‡∏ß‡∏£‡∏µ‡∏ô‡∏µ‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡∏™‡∏µ‡πà‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà: `(Artists)`, `(Albums)`, `(Tracks)`, ‡πÅ‡∏•‡∏∞ `(Genres)` ‡πÇ‡∏î‡∏¢‡∏ü‡∏•‡∏∏‡∏Ñ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÅ‡∏ó‡∏£‡πá‡∏Å‡πÄ‡∏û‡∏•‡∏á 100 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏û‡∏•‡∏á (Genre) ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£? `‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå` +`Data` 555+"

```{sql connection=con, output.var="join_result"}
SELECT
    ar.Name AS ArtistName,
    al.Title as AlbumTitle,
    tr.Name AS TrackName,
    ge.Name AS Genre
FROM Artists ar
JOIN Albums  al ON ar.ArtistId = al.ArtistId
JOIN Tracks  tr ON al.AlbumId = tr.AlbumId
JOIN Genres  ge ON tr.GenreId = ge.GenreId
LIMIT 100;
```

> **Result:**

```{r}
datatable(join_result,
          options = list(pageLength = 5, autoWidth = TRUE),
          caption = "Interactive table of joined music data.",
          rownames = FALSE)
```

‡πÇ‡∏î‡∏¢‡∏à‡∏≤‡∏Å `result` ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ `JOIN` ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏∏ **`100 ‡πÅ‡∏ó‡∏£‡πá‡∏Å‡∏ó‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î`** ‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏û‡∏•‡∏á ‡πÄ‡∏ä‡πà‡∏ô `Rock` ‡∏Å‡∏±‡∏ö `Pop` ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏û‡∏≠‡πÄ‡∏£‡∏≤‡∏£‡∏π‡πâ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏¥‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤

### SQL JOIN Types (‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£ JOIN)

‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡∏±‡∏ß‡∏ß‡πà‡∏≤ `JOIN` ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£ ‡πÅ‡∏ï‡πà‡∏à‡∏£‡∏¥‡∏á‡πÜ‡πÅ‡∏•‡πâ‡∏ß `JOIN` ‡∏ô‡∏±‡πâ‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡πÇ‡∏î‡∏¢‡∏ü‡∏•‡∏∏‡∏Ñ‡πÑ‡∏î‡πâ‡∏™‡∏£‡∏∏‡∏õ‡πÑ‡∏ß‡πâ‡∏î‡∏±‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ

| JOIN Type | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÇ‡∏î‡∏¢‡∏¢‡πà‡∏≠ | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ (Retained Rows) |
|:---|:---|:---|
| **INNER JOIN** | ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á | ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô (Intersection) |
| **LEFT JOIN** | ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡πÅ‡∏ñ‡∏ß‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô `NULL` | ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏ã‡πâ‡∏≤‡∏¢ + ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô |
| **RIGHT JOIN** | ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡πÅ‡∏ñ‡∏ß‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤ ‡πÅ‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô `NULL` | ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏Ç‡∏ß‡∏≤ + ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô |
| **FULL JOIN** | ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡πÅ‡∏ñ‡∏ß‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á ‡πÉ‡∏™‡πà `NULL` ‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡πà | ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏ã‡πâ‡∏≤‡∏¢ `Union` ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏Ç‡∏ß‡∏≤ |
| **SELF JOIN** | `JOIN` ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ (Alias) | ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó `JOIN` ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ |

![](JOIN.png)

Note: `SQLite` ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `INNER` ‡πÅ‡∏•‡∏∞ `LEFT OUTER` ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏™‡πà‡∏ß‡∏ô `RIGHT/FULL` ‡∏°‡∏±‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÅ‡∏ó‡∏ô‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏•‡∏±‡∏ö555+ü§£

### JOIN Types with Chinook

‡∏Ñ‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏°‡∏≤‡∏•‡∏≠‡∏á‡∏°‡∏≤‡∏•‡∏≠‡∏á run `JOIN` ‡∏ä‡∏ô‡∏¥‡∏î‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô

#### INNER JOIN (Customers √ó Invoices)

```{sql connection=con, output.var="inner_join_demo"}
SELECT
  c.CustomerId,
  c.FirstName || ' ' || c.LastName AS CustomerName,
  i.InvoiceId,
  DATE(i.InvoiceDate) AS InvoiceDate
FROM Customers c
INNER JOIN Invoices i ON c.CustomerId = i.CustomerId
ORDER BY i.InvoiceDate
LIMIT 20;
```

```{r}
datatable(inner_join_demo,
          options = list(pageLength = 5, autoWidth = TRUE),
          caption = "INNER JOIN: Customers with their invoices (first 20).",
          rownames = FALSE)
```

#### LEFT JOIN (Customers ‚üï Invoices)

```{sql connection=con, output.var="left_join_demo"}
SELECT
  c.CustomerId,
  c.FirstName || ' ' || c.LastName AS CustomerName,
  i.InvoiceId,
  DATE(i.InvoiceDate) AS InvoiceDate
FROM Customers c
LEFT JOIN Invoices i ON c.CustomerId = i.CustomerId
ORDER BY c.CustomerId, i.InvoiceDate
LIMIT 40;
```

```{r}
datatable(left_join_demo,
          options = list(pageLength = 5, autoWidth = TRUE),
          caption = "LEFT JOIN: All customers, invoices as available (first 40 rows).",
          rownames = FALSE)
```

#### RIGHT JOIN (Emulated) (Invoices ‚üñ Customers)

```{sql connection=con, output.var="right_join_demo"}
SELECT
  c.CustomerId,
  c.FirstName || ' ' || c.LastName AS CustomerName,
  i.InvoiceId,
  DATE(i.InvoiceDate) AS InvoiceDate
FROM Invoices i
LEFT JOIN Customers c ON i.CustomerId = c.CustomerId
ORDER BY i.InvoiceDate
LIMIT 40;
```

```{r}
datatable(right_join_demo,
          options = list(pageLength = 5, autoWidth = TRUE),
          caption = "RIGHT JOIN emulation: All invoices, customers when matched.",
          rownames = FALSE)
```

#### FULL JOIN (Emulated with UNION)

```{sql connection=con, output.var="full_join_demo"}
-- Simplified FULL JOIN emulation using LEFT JOIN only
-- This shows all customers with their invoices (when available)
SELECT
  c.CustomerId,
  c.FirstName || ' ' || c.LastName AS CustomerName,
  i.InvoiceId,
  DATE(i.InvoiceDate) AS InvoiceDate
FROM Customers c
LEFT JOIN Invoices i ON c.CustomerId = i.CustomerId
ORDER BY c.CustomerId, i.InvoiceDate
LIMIT 50;
```

```{r}
datatable(full_join_demo,
          options = list(pageLength = 5, autoWidth = TRUE),
          caption = "FULL JOIN simplified: All customers with their invoices (first 50 rows).",
          rownames = FALSE)
```

#### SELF JOIN (Employees ‚Üî Managers)

```{sql connection=con, output.var="self_join_demo"}
SELECT
  e.EmployeeId,
  e.FirstName || ' ' || e.LastName AS Employee,
  m.FirstName || ' ' || m.LastName AS Manager
FROM Employees e
LEFT JOIN Employees m ON e.ReportsTo = m.EmployeeId
ORDER BY Manager IS NULL DESC, Manager, Employee
LIMIT 100;
```

```{r}
datatable(self_join_demo,
          options = list(pageLength = 10, autoWidth = TRUE),
          caption = "SELF JOIN: Employees and their managers (from Chinook).",
          rownames = FALSE)
```

## ![](DuckCool.png){width="22"}3. Aggregate Functions

‡πÇ‡∏î‡∏¢‡∏°‡∏≤‡∏ï‡πà‡∏≠‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Aggregate Function ‡∏≠‡∏¢‡πà‡∏≤‡∏á `COUNT()` ‡∏ô‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î `COUNT(*)` ‡πÅ‡∏•‡∏∞ ‡∏ô‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥ `COUNT(DISTINCT ColumnName)` `Key Word` ‡πÉ‡∏ä‡πâ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß .

```{sql connection=con, output.var="count_result"}
SELECT
    COUNT(*) as TotalCustomers,
    COUNT(Company) as B2BCustomers
FROM Customers;
```

> **Result:**‚ùì ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡∏µ‡πà‡∏Ñ‡∏ô ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô B2B (‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó) ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏µ‡πà‡∏£‡∏≤‡∏¢?

```{r}
datatable(count_result, 
          options = list(dom = 't'), ## 't' means table only, no search/paging
          caption = "Summary of total vs. B2B customers.",
          rownames = FALSE)
```

## ![](DuckCool.png){width="22"} 4. Advanced Aggregation (`GROUP BY`, `HAVING`)

‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏≤‡∏£ `Filter` `GROUP BY` ‡πÅ‡∏•‡∏∞ `HAVING` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà‡∏ó‡∏£‡∏á‡∏û‡∏•‡∏±‡∏á‡πÅ‡∏•‡∏∞`Filter` ‡πÇ‡∏î‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Ñ‡∏¥‡∏ß‡∏£‡∏µ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà ‡∏™‡∏´‡∏£‡∏±‡∏ê‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤ (USA) ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ 5 ‡∏£‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥ `Sorting`

```{sql connection=con, output.var="filtered_agg_result"}
SELECT
    Country,
    COUNT(*) AS NumberOfCustomers
FROM Customers
WHERE Country <> 'USA'
GROUP BY Country
HAVING COUNT(*) >= 5
ORDER BY NumberOfCustomers DESC;
```

> **Result:** A ranked list of top customer countries (excluding the USA).

```{r}
datatable(filtered_agg_result,
          options = list(pageLength = 10),
          caption = "Countries (non-USA) with 5 or more customers.",
          rownames = FALSE)
```

## ![](DuckCool.png){width="22"} 5. Conditional Logic (`CASE WHEN`)

‡∏°‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠ `If clause` ‡πÉ‡∏ô `SQL` ‡πÉ‡∏ä‡πâ‡πÅ‡∏¢‡∏Å‡∏•‡∏π‡∏Å `B2B` ‡πÅ‡∏•‡∏∞ `B2C` ‡πÅ‡∏Ñ‡πà‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏•‡∏¢

```{sql connection=con, output.var="case_result"}
SELECT
    FirstName || ' ' || LastName AS FullName,
    Company,
    Country,
    CASE
        WHEN Company IS NULL THEN 'B2C (Consumer)'
        ELSE 'B2B (Business)'
    END AS Segment
FROM Customers
LIMIT 100;
```

> **Result:** The table below includes the dynamically generated `Segment` column. Try searching for "B2B" or "B2C".

```{r}
datatable(case_result,
          options = list(pageLength = 5),
          caption = "Customer segmentation using CASE WHEN.",
          rownames = FALSE)
```

## ![](DuckCool.png){width="22"}6. Common Table Expression (`WITH`)

`Common Table Expressions (CTEs)` ‡∏Ñ‡∏∑‡∏≠‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Ñ‡∏¥‡∏ß‡∏£‡∏µ‡∏ó‡∏µ‡πà `complex` ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏°‡∏µ '‡πÇ‡∏°‡∏î‡∏π‡∏•' ‡πÇ‡∏î‡∏¢ `concept` ‡∏Ñ‡∏∑‡∏≠ `‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏à‡∏≥‡∏•‡∏≠‡∏á` ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà‡πÉ‡∏ô‡∏Ñ‡∏¥‡∏ß‡∏£‡∏µ‡∏ô‡∏±‡πâ‡∏ô ‡πÜ

### Comparison: Standard Join vs. CTE {.tabset}

#### The Hard Way (Complex Join) ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏≤‡∏á‡∏¢‡∏≤‡∏Å‡∏ô‡∏∞555+

‡πÇ‡∏î‡∏¢‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏•‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏≠‡∏±‡∏ô‡πÑ‡∏´‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏á‡πà‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏±‡∏ô555+ ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏¥‡∏ß‡∏£‡∏µ‡∏™‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà`result`‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô ‡πÅ‡∏ï‡πà‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô

```{sql connection=con, eval=FALSE}
SELECT
    SUM(i.Total) as total_revenue_usa_cust_2009
FROM Customers c
JOIN Invoices i ON c.CustomerId = i.CustomerId
WHERE
    c.Country = 'USA' AND
    STRFTIME('%Y', i.InvoiceDate) = '2009';
```

#### The Better Way (with CTE)

‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `concept CTE`

```{sql connection=con, output.var="cte_result"}
WITH usa_customers AS (
    SELECT * FROM Customers
    WHERE Country = 'USA'
), 
invoices_y2009 AS (
    SELECT * FROM Invoices
    WHERE STRFTIME('%Y', InvoiceDate) = '2009'
)
SELECT
    SUM(t2.Total) as TotalRevenueUsa2009
FROM usa_customers t1
JOIN invoices_y2009 t2
    ON t1.CustomerId = t2.CustomerId;
```

### Query Result

Both queries produce the same result, but the CTE approach is far more maintainable. ‡πÅ‡∏õ‡∏•`result` ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÅ‡∏ï‡πà‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏•‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏â‡∏µ‡∏¢‡∏ö‡∏ö‡∏ö‡∏ö‡∏ö‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏ô‡πÑ‡∏´‡∏ô555+

```{r}
# Format the result nicely
cte_result$TotalRevenueUsa2009 <- paste0("$", round(cte_result$TotalRevenueUsa2009, 2))

datatable(cte_result,
          options = list(dom = 't'),
          caption = "Total 2009 revenue from USA customers.",
          rownames = FALSE)
```

------------------------------------------------------------------------

```{r cleanup, include=FALSE}
# Close the database connection
dbDisconnect(con)
```

‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ô‡∏µ‡πâ ‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡∏Å‡∏±‡∏ö‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏° `SQL Showcase` ‡∏ô‡∏µ‡πâ ‡πÄ‡∏¢‡πâ! ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ ‡∏û‡∏µ‡πà‡πÜ ‡∏ô‡πâ‡∏≠‡∏á‡πÜ ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏∏‡πà‡∏á‡∏°‡∏±‡πà‡∏ô‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏ô‡∏à‡∏ö ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏•‡∏¢ ‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏û‡∏µ‡πà‡∏ó‡∏≠‡∏¢ `DataRockie` ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≠‡∏¢‡∏ã‡∏±‡∏û‡∏û‡∏≠‡∏£‡πå‡∏ï‡πÄ‡∏£‡∏≤‡πÄ‡∏™‡∏°‡∏≠‡∏°‡∏≤ ‡∏ü‡∏•‡∏∏‡∏Ñ‡∏´‡∏ß‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏à‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÜ ‡∏ß‡∏±‡∏ô `(Generalist ‡∏Å‡πá‡∏°‡∏≤ 555!)` ‡πÅ‡∏•‡∏∞‡∏´‡∏ß‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á `SQL` ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡πÜ ‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏¢‡πâ! ‡∏Å‡∏£‡∏≤‡∏ö‡∏ö‡∏ö‡∏ö‡∏ö ‡∏õ‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì ‡∏â‡∏ö‡∏±‡∏ö‡∏ü‡∏•‡∏∏‡∏Ñ‡πÉ‡∏ô `SQL version` ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ ‡∏ô‡πâ‡∏≠‡∏á‡πÜ ‡πÑ‡∏î‡πâ‡πÄ‡∏´‡πá‡∏ô `Portfolio` ‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏ó‡∏µ‡πà‡∏ó‡∏£‡∏á‡∏û‡∏•‡∏±‡∏á ‡∏ü‡∏•‡∏∏‡∏Ñ‡∏£‡∏±‡∏Å‡∏Ñ‡∏ôüê§üíõ
